const NODE_SUFFIX = "èŠ‚ç‚¹"; function parseBool(e) { return "boolean" == typeof e ? e : "string" == typeof e && ("true" === e.toLowerCase() || "1" === e) } function parseNumber(e, t = 0) { if (null == e) return t; const o = parseInt(e, 10); return isNaN(o) ? t : o } function buildFeatureFlags(e) { const t = Object.entries({ loadbalance: "loadBalance", landing: "landing", ipv6: "ipv6Enabled", full: "fullConfig", keepalive: "keepAliveEnabled", fakeip: "fakeIPEnabled", quic: "quicEnabled" }).reduce((t, [o, r]) => (t[r] = parseBool(e[o]) || !1, t), {}); return t.countryThreshold = parseNumber(e.threshold, 0), t } const rawArgs = "undefined" != typeof $arguments ? $arguments : {}, { loadBalance: loadBalance, landing: landing, ipv6Enabled: ipv6Enabled, fullConfig: fullConfig, keepAliveEnabled: keepAliveEnabled, fakeIPEnabled: fakeIPEnabled, quicEnabled: quicEnabled, countryThreshold: countryThreshold } = buildFeatureFlags(rawArgs); function getCountryGroupNames(e, t) { return e.filter(e => e.count >= t).map(e => e.country + "èŠ‚ç‚¹") } function stripNodeSuffix(e) { const t = new RegExp("èŠ‚ç‚¹$"); return e.map(e => e.replace(t, "")) } const PROXY_GROUPS = { MANUAL: "æ‰‹åŠ¨é€‰æ‹©",SELECT: "è‡ªåŠ¨ä¼˜é€‰",  FALLBACK: "æ•…éšœè½¬ç§»", DIRECT: "ç›´è¿ž", LANDING: "è½åœ°èŠ‚ç‚¹", LOW_COST: "ä½Žå€çŽ‡èŠ‚ç‚¹" }, buildList = (...e) => e.flat().filter(Boolean); function buildBaseLists({ landing: e, lowCost: t, countryGroupNames: o }) { const r = buildList(PROXY_GROUPS.FALLBACK, e && PROXY_GROUPS.LANDING, o, t && PROXY_GROUPS.LOW_COST, PROXY_GROUPS.MANUAL, "DIRECT"); return { defaultProxies: buildList(PROXY_GROUPS.SELECT, o, t && PROXY_GROUPS.LOW_COST, PROXY_GROUPS.MANUAL, PROXY_GROUPS.DIRECT), defaultProxiesDirect: buildList(PROXY_GROUPS.DIRECT, o, t && PROXY_GROUPS.LOW_COST, PROXY_GROUPS.SELECT, PROXY_GROUPS.MANUAL), defaultSelector: r, defaultFallback: buildList(e && PROXY_GROUPS.LANDING, o, t && PROXY_GROUPS.LOW_COST, PROXY_GROUPS.MANUAL, "DIRECT") } } const ruleProviders = { ADBlock: { type: "http", behavior: "domain", format: "mrs", interval: 86400, url: "https://adrules.top/adrules-mihomo.mrs", path: "./ruleset/ADBlock.mrs" }, SogouInput: { type: "http", behavior: "classical", format: "text", interval: 86400, url: "https://ruleset.skk.moe/Clash/non_ip/sogouinput.txt", path: "./ruleset/SogouInput.txt" }, StaticResources: { type: "http", behavior: "domain", format: "text", interval: 86400, url: "https://ruleset.skk.moe/Clash/domainset/cdn.txt", path: "./ruleset/StaticResources.txt" }, CDNResources: { type: "http", behavior: "classical", format: "text", interval: 86400, url: "https://ruleset.skk.moe/Clash/non_ip/cdn.txt", path: "./ruleset/CDNResources.txt" }, TikTok: { type: "http", behavior: "classical", format: "text", interval: 86400, url: "https://gcore.jsdelivr.net/gh/powerfullz/override-rules@master/ruleset/TikTok.list", path: "./ruleset/TikTok.list" }, EHentai: { type: "http", behavior: "classical", format: "text", interval: 86400, url: "https://gcore.jsdelivr.net/gh/powerfullz/override-rules@master/ruleset/EHentai.list", path: "./ruleset/EHentai.list" }, SteamFix: { type: "http", behavior: "classical", format: "text", interval: 86400, url: "https://gcore.jsdelivr.net/gh/powerfullz/override-rules@master/ruleset/SteamFix.list", path: "./ruleset/SteamFix.list" }, GoogleFCM: { type: "http", behavior: "classical", format: "text", interval: 86400, url: "https://gcore.jsdelivr.net/gh/powerfullz/override-rules@master/ruleset/FirebaseCloudMessaging.list", path: "./ruleset/FirebaseCloudMessaging.list" }, AdditionalFilter: { type: "http", behavior: "classical", format: "text", interval: 86400, url: "https://gcore.jsdelivr.net/gh/powerfullz/override-rules@master/ruleset/AdditionalFilter.list", path: "./ruleset/AdditionalFilter.list" }, AdditionalCDNResources: { type: "http", behavior: "classical", format: "text", interval: 86400, url: "https://gcore.jsdelivr.net/gh/powerfullz/override-rules@master/ruleset/AdditionalCDNResources.list", path: "./ruleset/AdditionalCDNResources.list" }, Crypto: { type: "http", behavior: "classical", format: "text", interval: 86400, url: "https://gcore.jsdelivr.net/gh/powerfullz/override-rules@master/ruleset/Crypto.list", path: "./ruleset/Crypto.list" } }, baseRules = ["RULE-SET,ADBlock,å¹¿å‘Šæ‹¦æˆª", "RULE-SET,AdditionalFilter,å¹¿å‘Šæ‹¦æˆª", "RULE-SET,SogouInput,æœç‹—è¾“å…¥æ³•", "DOMAIN-SUFFIX,truthsocial.com,Truth Social", "RULE-SET,StaticResources,é™æ€èµ„æº", "RULE-SET,CDNResources,é™æ€èµ„æº", "RULE-SET,AdditionalCDNResources,é™æ€èµ„æº", "RULE-SET,Crypto,Crypto", "RULE-SET,EHentai,E-Hentai", "RULE-SET,TikTok,TikTok", `RULE-SET,SteamFix,${PROXY_GROUPS.DIRECT}`, `RULE-SET,GoogleFCM,${PROXY_GROUPS.DIRECT}`, `DOMAIN,services.googleapis.cn,${PROXY_GROUPS.SELECT}`, `GEOSITE,GOOGLE-PLAY@CN,${PROXY_GROUPS.DIRECT}`, "GEOSITE,CATEGORY-AI-!CN,AI", "GEOSITE,TELEGRAM,Telegram", "GEOSITE,YOUTUBE,YouTube", "GEOSITE,NETFLIX,Netflix", "GEOSITE,SPOTIFY,Spotify", "GEOSITE,BAHAMUT,Bahamut", "GEOSITE,BILIBILI,Bilibili", `GEOSITE,MICROSOFT@CN,${PROXY_GROUPS.DIRECT}`, "GEOSITE,PIKPAK,PikPak", `GEOSITE,GFW,${PROXY_GROUPS.SELECT}`, `GEOSITE,CN,${PROXY_GROUPS.DIRECT}`, `GEOSITE,PRIVATE,${PROXY_GROUPS.DIRECT}`, "GEOIP,NETFLIX,Netflix,no-resolve", "GEOIP,TELEGRAM,Telegram,no-resolve", `GEOIP,CN,${PROXY_GROUPS.DIRECT}`, `GEOIP,PRIVATE,${PROXY_GROUPS.DIRECT}`, "DST-PORT,22,SSH(22ç«¯å£)", `MATCH,${PROXY_GROUPS.SELECT}`]; function buildRules({ quicEnabled: e }) { const t = [...baseRules]; return e || t.unshift("AND,((DST-PORT,443),(NETWORK,UDP)),REJECT"), t } const snifferConfig = { sniff: { TLS: { ports: [443, 8443] }, HTTP: { ports: [80, 8080, 8880] }, QUIC: { ports: [443, 8443] } }, "override-destination": !1, enable: !0, "force-dns-mapping": !0, "skip-domain": ["Mijia Cloud", "dlg.io.mi.com", "+.push.apple.com"] }; function buildDnsConfig({ mode: e, fakeIpFilter: t }) { const o = { enable: !0, ipv6: ipv6Enabled, "prefer-h3": !0, "enhanced-mode": e, "default-nameserver": ["119.29.29.29", "223.5.5.5"], nameserver: ["system", "223.5.5.5", "119.29.29.29", "180.184.1.1"], fallback: ["quic://dns0.eu", "https://dns.cloudflare.com/dns-query", "https://dns.sb/dns-query", "tcp://208.67.222.222", "tcp://8.26.56.2"], "proxy-server-nameserver": ["https://dns.alidns.com/dns-query", "tls://dot.pub"] }; return t && (o["fake-ip-filter"] = t), o } const dnsConfig = buildDnsConfig({ mode: "redir-host" }), dnsConfigFakeIp = buildDnsConfig({ mode: "fake-ip", fakeIpFilter: ["geosite:private", "geosite:connectivity-check", "geosite:cn", "Mijia Cloud", "dig.io.mi.com", "localhost.ptlogin2.qq.com", "*.icloud.com", "*.stun.*.*", "*.stun.*.*.*"] }), geoxURL = { geoip: "https://gcore.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geoip.dat", geosite: "https://gcore.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geosite.dat", mmdb: "https://gcore.jsdelivr.net/gh/Loyalsoldier/geoip@release/Country.mmdb", asn: "https://gcore.jsdelivr.net/gh/Loyalsoldier/geoip@release/GeoLite2-ASN.mmdb" }, countriesMeta = { "é¦™æ¸¯": { pattern: "(?i)é¦™æ¸¯|æ¸¯|HK|hk|Hong Kong|HongKong|hongkong|ðŸ‡­ðŸ‡°", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Hong_Kong.png" }, "æ¾³é—¨": { pattern: "(?i)æ¾³é—¨|MO|Macau|ðŸ‡²ðŸ‡´", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Macao.png" }, "å°æ¹¾": { pattern: "(?i)å°|æ–°åŒ—|å½°åŒ–|TW|Taiwan|ðŸ‡¹ðŸ‡¼", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Taiwan.png" }, "æ–°åŠ å¡": { pattern: "(?i)æ–°åŠ å¡|å¡|ç‹®åŸŽ|SG|Singapore|ðŸ‡¸ðŸ‡¬", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Singapore.png" }, "æ—¥æœ¬": { pattern: "(?i)æ—¥æœ¬|å·æ—¥|ä¸œäº¬|å¤§é˜ª|æ³‰æ—¥|åŸ¼çŽ‰|æ²ªæ—¥|æ·±æ—¥|JP|Japan|ðŸ‡¯ðŸ‡µ", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Japan.png" }, "éŸ©å›½": { pattern: "(?i)KR|Korea|KOR|é¦–å°”|éŸ©|éŸ“|ðŸ‡°ðŸ‡·", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Korea.png" }, "ç¾Žå›½": { pattern: "(?i)ç¾Žå›½|ç¾Ž|US|United States|ðŸ‡ºðŸ‡¸", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/United_States.png" }, "åŠ æ‹¿å¤§": { pattern: "(?i)åŠ æ‹¿å¤§|Canada|CA|ðŸ‡¨ðŸ‡¦", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Canada.png" }, "è‹±å›½": { pattern: "(?i)è‹±å›½|United Kingdom|UK|ä¼¦æ•¦|London|ðŸ‡¬ðŸ‡§", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/United_Kingdom.png" }, "æ¾³å¤§åˆ©äºš": { pattern: "(?i)æ¾³æ´²|æ¾³å¤§åˆ©äºš|AU|Australia|ðŸ‡¦ðŸ‡º", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Australia.png" }, "å¾·å›½": { pattern: "(?i)å¾·å›½|å¾·|DE|Germany|ðŸ‡©ðŸ‡ª", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Germany.png" }, "æ³•å›½": { pattern: "(?i)æ³•å›½|æ³•|FR|France|ðŸ‡«ðŸ‡·", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/France.png" }, "ä¿„ç½—æ–¯": { pattern: "(?i)ä¿„ç½—æ–¯|ä¿„|RU|Russia|ðŸ‡·ðŸ‡º", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Russia.png" }, "æ³°å›½": { pattern: "(?i)æ³°å›½|æ³°|TH|Thailand|ðŸ‡¹ðŸ‡­", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Thailand.png" }, "å°åº¦": { pattern: "(?i)å°åº¦|IN|India|ðŸ‡®ðŸ‡³", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/India.png" }, "é©¬æ¥è¥¿äºš": { pattern: "(?i)é©¬æ¥è¥¿äºš|é©¬æ¥|MY|Malaysia|ðŸ‡²ðŸ‡¾", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Malaysia.png" } }; function hasLowCost(e) { const t = /0\.[0-5]|ä½Žå€çŽ‡|çœæµ|å¤§æµé‡|å®žéªŒæ€§/i; return (e.proxies || []).some(e => t.test(e.name)) } function parseCountries(e) { const t = e.proxies || [], o = /å®¶å®½|å®¶åº­|å®¶åº­å®½å¸¦|å•†å®½|å•†ä¸šå®½å¸¦|æ˜Ÿé“¾|Starlink|è½åœ°/i, r = Object.create(null), n = {}; for (const [e, t] of Object.entries(countriesMeta)) n[e] = new RegExp(t.pattern.replace(/^\(\?i\)/, ""), "i"); for (const e of t) { const t = e.name || ""; if (!o.test(t)) for (const [e, o] of Object.entries(n)) if (o.test(t)) { r[e] = (r[e] || 0) + 1; break } } const s = []; for (const [e, t] of Object.entries(r)) s.push({ country: e, count: t }); return s } function buildCountryProxyGroups({ countries: e, landing: t, loadBalance: o }) { const r = [], n = "0\\.[0-5]|ä½Žå€çŽ‡|çœæµ|å¤§æµé‡|å®žéªŒæ€§", s = o ? "load-balance" : "url-test"; for (const l of e) { const e = countriesMeta[l]; if (!e) continue; const i = { name: `${l}èŠ‚ç‚¹`, icon: e.icon, "include-all": !0, filter: e.pattern, "exclude-filter": t ? `(?i)å®¶å®½|å®¶åº­|å®¶åº­å®½å¸¦|å•†å®½|å•†ä¸šå®½å¸¦|æ˜Ÿé“¾|Starlink|è½åœ°|${n}` : n, type: s }; o || Object.assign(i, { url: "https://cp.cloudflare.com/generate_204", interval: 60, tolerance: 20, lazy: !1 }), r.push(i) } return r } function buildProxyGroups({ landing: e, countries: t, countryProxyGroups: o, lowCost: r, defaultProxies: n, defaultProxiesDirect: s, defaultSelector: l, defaultFallback: i }) { const a = t.includes("å°æ¹¾"), c = t.includes("é¦™æ¸¯"), p = t.includes("ç¾Žå›½"), u = e ? l.filter(e => e !== PROXY_GROUPS.LANDING && e !== PROXY_GROUPS.FALLBACK) : []; return [{ name: PROXY_GROUPS.SELECT, icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Proxy.png", type: "select", proxies: l }, { name: PROXY_GROUPS.MANUAL, icon: "https://gcore.jsdelivr.net/gh/shindgewongxj/WHATSINStash@master/icon/select.png", "include-all": !0, type: "select" }, e ? { name: "å‰ç½®ä»£ç†", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Area.png", type: "select", "include-all": !0, "exclude-filter": "(?i)å®¶å®½|å®¶åº­|å®¶åº­å®½å¸¦|å•†å®½|å•†ä¸šå®½å¸¦|æ˜Ÿé“¾|Starlink|è½åœ°", proxies: u } : null, e ? { name: PROXY_GROUPS.LANDING, icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Airport.png", type: "select", "include-all": !0, filter: "(?i)å®¶å®½|å®¶åº­|å®¶åº­å®½å¸¦|å•†å®½|å•†ä¸šå®½å¸¦|æ˜Ÿé“¾|Starlink|è½åœ°" } : null, { name: PROXY_GROUPS.FALLBACK, icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Bypass.png", type: "fallback", url: "https://cp.cloudflare.com/generate_204", proxies: i, interval: 180, tolerance: 20, lazy: !1 }, { name: "é™æ€èµ„æº", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Cloudflare.png", type: "select", proxies: n }, { name: "AI", icon: "https://gcore.jsdelivr.net/gh/powerfullz/override-rules@master/icons/chatgpt.png", type: "select", proxies: n }, { name: "Telegram", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Telegram.png", type: "select", proxies: n }, { name: "YouTube", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/YouTube.png", type: "select", proxies: n }, { name: "Bilibili", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/bilibili.png", type: "select", proxies: a && c ? [PROXY_GROUPS.DIRECT, "å°æ¹¾èŠ‚ç‚¹", "é¦™æ¸¯èŠ‚ç‚¹"] : s }, { name: "Netflix", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Netflix.png", type: "select", proxies: n }, { name: "Spotify", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Spotify.png", type: "select", proxies: n }, { name: "TikTok", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/TikTok.png", type: "select", proxies: n }, { name: "E-Hentai", icon: "https://gcore.jsdelivr.net/gh/powerfullz/override-rules@master/icons/Ehentai.png", type: "select", proxies: n }, { name: "PikPak", icon: "https://gcore.jsdelivr.net/gh/powerfullz/override-rules@master/icons/PikPak.png", type: "select", proxies: n }, { name: "Truth Social", icon: "https://gcore.jsdelivr.net/gh/powerfullz/override-rules@master/icons/TruthSocial.png", type: "select", proxies: p ? ["ç¾Žå›½èŠ‚ç‚¹", PROXY_GROUPS.SELECT, PROXY_GROUPS.MANUAL] : n }, { name: "Bahamut", icon: "https://cdn.jsdmirror.com/gh/Koolson/Qure@master/IconSet/Color/Bahamut.png", type: "select", proxies: a ? ["å°æ¹¾èŠ‚ç‚¹", PROXY_GROUPS.SELECT, PROXY_GROUPS.MANUAL, PROXY_GROUPS.DIRECT] : n }, { name: "Crypto", icon: "https://cdn.jsdmirror.com/gh/Koolson/Qure@master/IconSet/Color/Cryptocurrency_3.png", type: "select", proxies: n }, { name: "SSH(22ç«¯å£)", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Server.png", type: "select", proxies: n }, { name: "æœç‹—è¾“å…¥æ³•", icon: "https://gcore.jsdelivr.net/gh/powerfullz/override-rules@master/icons/Sougou.png", type: "select", proxies: [PROXY_GROUPS.DIRECT, "REJECT"] }, { name: PROXY_GROUPS.DIRECT, icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Direct.png", type: "select", proxies: ["DIRECT", PROXY_GROUPS.SELECT] }, { name: "å¹¿å‘Šæ‹¦æˆª", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/AdBlack.png", type: "select", proxies: ["REJECT", "REJECT-DROP", PROXY_GROUPS.DIRECT] }, r ? { name: PROXY_GROUPS.LOW_COST, icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Lab.png", type: "url-test", url: "https://cp.cloudflare.com/generate_204", "include-all": !0, filter: "(?i)0.[0-5]|ä½Žå€çŽ‡|çœæµ|å¤§æµé‡|å®žéªŒæ€§" } : null, ...o].filter(Boolean) } function main(e) { const t = { proxies: e.proxies }, o = parseCountries(t), r = hasLowCost(t), n = getCountryGroupNames(o, countryThreshold), s = stripNodeSuffix(n), { defaultProxies: l, defaultProxiesDirect: i, defaultSelector: a, defaultFallback: c } = buildBaseLists({ landing: landing, lowCost: r, countryGroupNames: n }), p = buildCountryProxyGroups({ countries: s, landing: landing, loadBalance: loadBalance }), u = buildProxyGroups({ landing: landing, countries: s, countryProxyGroups: p, lowCost: r, defaultProxies: l, defaultProxiesDirect: i, defaultSelector: a, defaultFallback: c }), d = u.map(e => e.name); u.push({ name: "GLOBAL", icon: "https://gcore.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Global.png", "include-all": !0, type: "select", proxies: d }); const g = buildRules({ quicEnabled: quicEnabled }); return fullConfig && Object.assign(t, { "mixed-port": 7890, "redir-port": 7892, "tproxy-port": 7893, "routing-mark": 7894, "allow-lan": !0, ipv6: ipv6Enabled, mode: "rule", "unified-delay": !0, "tcp-concurrent": !0, "find-process-mode": "off", "log-level": "info", "geodata-loader": "standard", "external-controller": ":9999", "disable-keep-alive": !keepAliveEnabled, profile: { "store-selected": !0 } }), Object.assign(t, { "proxy-groups": u, "rule-providers": ruleProviders, rules: g, sniffer: snifferConfig, dns: fakeIPEnabled ? dnsConfigFakeIp : dnsConfig, "geodata-mode": !0, "geox-url": geoxURL }), t }